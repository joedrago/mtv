(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
var CastPlayer, beginCast, init, lastClicked, processHash, renderEntries, showBoth, showHistory, showList, showPlaylist, showQueue, socket;

socket = null;

lastClicked = null;

renderEntries = function(domID, firstTitle, restTitle, entries, isMap) {
  var e, entryIndex, extraInfo, html, i, k, len, m, params, title, url, v;
  html = "";
  if (isMap) {
    console.log(entries);
    m = entries;
    entries = [];
    for (k in m) {
      v = m[k];
      entries.push(v);
    }
    // This is the "all" list, sort it
    entries.sort(function(a, b) {
      if (a.title < b.title) {
        return -1;
      }
      if (a.title > b.title) {
        return 1;
      }
      return 0;
    });
  }
  for (entryIndex = i = 0, len = entries.length; i < len; entryIndex = ++i) {
    e = entries[entryIndex];
    title = e.title;
    if (title == null) {
      title = e.id;
    }
    params = "";
    if (e.start >= 0) {
      params += params.length === 0 ? "?" : "&";
      params += `start=${e.start}`;
    }
    if (e.end >= 0) {
      params += params.length === 0 ? "?" : "&";
      params += `end=${e.end}`;
    }
    url = `https://youtu.be/${e.id}${params}`;
    extraInfo = "";
    if (e.countPlay != null) {
      extraInfo += `, ${e.countPlay} play${e.countPlay === 1 ? "" : "s"}`;
    }
    if (e.countSkip != null) {
      extraInfo += `, ${e.countSkip} skip${e.countSkip === 1 ? "" : "s"}`;
    }
    if (firstTitle != null) {
      if (entryIndex === 0) {
        html += `<div class="firstTitle">${firstTitle}</div>
<div class="previewContainer"><img class="preview" src="${e.thumb}"></div>`;
      } else if (entryIndex === 1) {
        html += `<div class="restTitle">${restTitle}</div>`;
      }
    }
    html += `<div> * <a target="_blank" href="${url}">${title}</a> <span class="user">(${e.user}${extraInfo})</span></div>
`;
  }
  return document.getElementById(domID).innerHTML = html;
};

showList = function(domID, firstTitle, restTitle, url, isMap = false) {
  var xhttp;
  // document.getElementById('main').innerHTML = ""
  xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    var entries;
    if ((this.readyState === 4) && (this.status === 200)) {
      try {
        // Typical action to be performed when the document is ready:
        entries = JSON.parse(xhttp.responseText);
        return renderEntries(domID, firstTitle, restTitle, entries, isMap);
      } catch (error) {
        return document.getElementById("main").innerHTML = "Error!";
      }
    }
  };
  xhttp.open("GET", url, true);
  return xhttp.send();
};

showHistory = function() {
  showList('main', "Now Playing:", "History:", "/info/history");
  return lastClicked = showHistory;
};

showQueue = function() {
  showList('main', "Up Next:", "Queue:", "/info/queue");
  return lastClicked = showQueue;
};

showBoth = function() {
  document.getElementById('main').innerHTML = `<div id="mainl"></div>
<div id="mainr"></div>`;
  showList('mainl', "Now Playing:", "History:", "/info/history");
  showList('mainr', "Up Next:", "Queue:", "/info/queue");
  return lastClicked = showBoth;
};

showPlaylist = function() {
  showList('main', null, null, "/info/playlist", true);
  return lastClicked = showPlaylist;
};

CastPlayer = class CastPlayer {
  constructor() {
    this.remotePlayer = null;
    this.remotePlayerController = null;
  }

  initializeCastPlayer() {
    var options;
    options = {
      autoJoinPolicy: chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED,
      receiverApplicationId: chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID
    };
    cast.framework.CastContext.getInstance().setOptions(options);
    this.remotePlayer = new cast.framework.RemotePlayer();
    this.remotePlayerController = new cast.framework.RemotePlayerController(this.remotePlayer);
    return this.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.IS_CONNECTED_CHANGED, this.switchPlayer.bind(this));
  }

  switchPlayer() {
    var sessionState;
    sessionState = cast.framework.CastContext.getInstance().getSessionState();
    if (sessionState !== cast.framework.SessionState.SESSION_STARTED) {
      console.log("Session ended!");
      return;
    }
    console.log("Session starting!");
    return socket.emit('castready', {
      id: socket.id
    });
  }

};

beginCast = function(pkt) {
  var castSession, mediaInfo, request, sessionState;
  console.log("CAST:", pkt);
  sessionState = cast.framework.CastContext.getInstance().getSessionState();
  if (sessionState !== cast.framework.SessionState.SESSION_STARTED) {
    console.log("No session; skipping beginCast");
    return;
  }
  console.log("Starting cast!");
  castSession = cast.framework.CastContext.getInstance().getCurrentSession();
  mediaInfo = new chrome.cast.media.MediaInfo(pkt.url, 'video/mp4');
  request = new chrome.cast.media.LoadRequest(mediaInfo);
  if (pkt.start > 0) {
    request.currentTime = pkt.start;
  }
  return castSession.loadMedia(request);
};

processHash = function() {
  var currentHash;
  currentHash = window.location.hash;
  switch (currentHash) {
    case '#queue':
      return showQueue();
    case '#all':
      return showPlaylist();
    case '#both':
      return showBoth();
    default:
      return showHistory();
  }
};

init = function() {
  window.showHistory = showHistory;
  window.showQueue = showQueue;
  window.showPlaylist = showPlaylist;
  window.onhashchange = processHash;
  processHash();
  socket = io();
  socket.on('cast', function(pkt) {
    return beginCast(pkt);
  });
  socket.on('play', function(pkt) {
    if (lastClicked != null) {
      return lastClicked();
    }
  });
  window.__onGCastApiAvailable = function(isAvailable) {
    var castPlayer;
    console.log(`__onGCastApiAvailable fired: ${isAvailable}`);
    castPlayer = new CastPlayer();
    if (isAvailable) {
      return castPlayer.initializeCastPlayer();
    }
  };
  return console.log("initialized!");
};

window.onload = init;


},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvY2xpZW50L2Rhc2hib2FyZC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQSxJQUFBLFVBQUEsRUFBQSxTQUFBLEVBQUEsSUFBQSxFQUFBLFdBQUEsRUFBQSxXQUFBLEVBQUEsYUFBQSxFQUFBLFFBQUEsRUFBQSxXQUFBLEVBQUEsUUFBQSxFQUFBLFlBQUEsRUFBQSxTQUFBLEVBQUE7O0FBQUEsTUFBQSxHQUFTOztBQUVULFdBQUEsR0FBYzs7QUFFZCxhQUFBLEdBQWdCLFFBQUEsQ0FBQyxLQUFELEVBQVEsVUFBUixFQUFvQixTQUFwQixFQUErQixPQUEvQixFQUF3QyxLQUF4QyxDQUFBO0FBQ2hCLE1BQUEsQ0FBQSxFQUFBLFVBQUEsRUFBQSxTQUFBLEVBQUEsSUFBQSxFQUFBLENBQUEsRUFBQSxDQUFBLEVBQUEsR0FBQSxFQUFBLENBQUEsRUFBQSxNQUFBLEVBQUEsS0FBQSxFQUFBLEdBQUEsRUFBQTtFQUFFLElBQUEsR0FBTztFQUVQLElBQUcsS0FBSDtJQUNFLE9BQU8sQ0FBQyxHQUFSLENBQVksT0FBWjtJQUNBLENBQUEsR0FBSTtJQUNKLE9BQUEsR0FBVTtJQUNWLEtBQUEsTUFBQTs7TUFDRSxPQUFPLENBQUMsSUFBUixDQUFhLENBQWI7SUFERixDQUhKOztJQU9JLE9BQU8sQ0FBQyxJQUFSLENBQWEsUUFBQSxDQUFDLENBQUQsRUFBSSxDQUFKLENBQUE7TUFDWCxJQUFHLENBQUMsQ0FBQyxLQUFGLEdBQVUsQ0FBQyxDQUFDLEtBQWY7QUFDRSxlQUFPLENBQUMsRUFEVjs7TUFFQSxJQUFHLENBQUMsQ0FBQyxLQUFGLEdBQVUsQ0FBQyxDQUFDLEtBQWY7QUFDRSxlQUFPLEVBRFQ7O0FBRUEsYUFBTztJQUxJLENBQWIsRUFSRjs7RUFlQSxLQUFBLG1FQUFBOztJQUNFLEtBQUEsR0FBUSxDQUFDLENBQUM7SUFDVixJQUFPLGFBQVA7TUFDRSxLQUFB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QUEsRUFERjs7RUFEZ0IsQ0FBbEI7RUFJQSxNQUFNLENBQUMscUJBQVAsR0FBK0IsUUFBQSxDQUFDLFdBQUQsQ0FBQTtBQUNqQyxRQUFBO0lBQUksT0FBTyxDQUFDLEdBQVIsQ0FBWSxDQUFBLDZCQUFBLENBQUEsQ0FBZ0MsV0FBaEMsQ0FBQSxDQUFaO0lBQ0EsVUFBQSxHQUFhLElBQUksVUFBSixDQUFBO0lBQ2IsSUFBRyxXQUFIO2FBQ0UsVUFBVSxDQUFDLG9CQUFYLENBQUEsRUFERjs7RUFINkI7U0FNL0IsT0FBTyxDQUFDLEdBQVIsQ0FBWSxjQUFaO0FBdEJLOztBQXdCUCxNQUFNLENBQUMsTUFBUCxHQUFnQiIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsInNvY2tldCA9IG51bGxcclxuXHJcbmxhc3RDbGlja2VkID0gbnVsbFxyXG5cclxucmVuZGVyRW50cmllcyA9IChkb21JRCwgZmlyc3RUaXRsZSwgcmVzdFRpdGxlLCBlbnRyaWVzLCBpc01hcCkgLT5cclxuICBodG1sID0gXCJcIlxyXG5cclxuICBpZiBpc01hcFxyXG4gICAgY29uc29sZS5sb2cgZW50cmllc1xyXG4gICAgbSA9IGVudHJpZXNcclxuICAgIGVudHJpZXMgPSBbXVxyXG4gICAgZm9yIGssIHYgb2YgbVxyXG4gICAgICBlbnRyaWVzLnB1c2ggdlxyXG5cclxuICAgICMgVGhpcyBpcyB0aGUgXCJhbGxcIiBsaXN0LCBzb3J0IGl0XHJcbiAgICBlbnRyaWVzLnNvcnQgKGEsIGIpIC0+XHJcbiAgICAgIGlmIGEudGl0bGUgPCBiLnRpdGxlXHJcbiAgICAgICAgcmV0dXJuIC0xXHJcbiAgICAgIGlmIGEudGl0bGUgPiBiLnRpdGxlXHJcbiAgICAgICAgcmV0dXJuIDFcclxuICAgICAgcmV0dXJuIDBcclxuXHJcbiAgZm9yIGUsIGVudHJ5SW5kZXggaW4gZW50cmllc1xyXG4gICAgdGl0bGUgPSBlLnRpdGxlXHJcbiAgICBpZiBub3QgdGl0bGU/XHJcbiAgICAgIHRpdGxlID0gZS5pZFxyXG4gICAgcGFyYW1zID0gXCJcIlxyXG4gICAgaWYgZS5zdGFydCA+PSAwXHJcbiAgICAgIHBhcmFtcyArPSBpZiBwYXJhbXMubGVuZ3RoID09IDAgdGhlbiBcIj9cIiBlbHNlIFwiJlwiXHJcbiAgICAgIHBhcmFtcyArPSBcInN0YXJ0PSN7ZS5zdGFydH1cIlxyXG4gICAgaWYgZS5lbmQgPj0gMFxyXG4gICAgICBwYXJhbXMgKz0gaWYgcGFyYW1zLmxlbmd0aCA9PSAwIHRoZW4gXCI/XCIgZWxzZSBcIiZcIlxyXG4gICAgICBwYXJhbXMgKz0gXCJlbmQ9I3tlLmVuZH1cIlxyXG4gICAgdXJsID0gXCJodHRwczovL3lvdXR1LmJlLyN7ZS5pZH0je3BhcmFtc31cIlxyXG4gICAgZXh0cmFJbmZvID0gXCJcIlxyXG4gICAgaWYgZS5jb3VudFBsYXk/XHJcbiAgICAgIGV4dHJhSW5mbyArPSBcIiwgI3tlLmNvdW50UGxheX0gcGxheSN7aWYgZS5jb3VudFBsYXkgPT0gMSB0aGVuIFwiXCIgZWxzZSBcInNcIn1cIlxyXG4gICAgaWYgZS5jb3VudFNraXA/XHJcbiAgICAgIGV4dHJhSW5mbyArPSBcIiwgI3tlLmNvdW50U2tpcH0gc2tpcCN7aWYgZS5jb3VudFNraXAgPT0gMSB0aGVuIFwiXCIgZWxzZSBcInNcIn1cIlxyXG5cclxuICAgIGlmIGZpcnN0VGl0bGU/XHJcbiAgICAgIGlmIChlbnRyeUluZGV4ID09IDApXHJcbiAgICAgICAgaHRtbCArPSBcIlwiXCJcclxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJmaXJzdFRpdGxlXCI+I3tmaXJzdFRpdGxlfTwvZGl2PlxyXG4gICAgICAgICAgPGRpdiBjbGFzcz1cInByZXZpZXdDb250YWluZXJcIj48aW1nIGNsYXNzPVwicHJldmlld1wiIHNyYz1cIiN7ZS50aHVtYn1cIj48L2Rpdj5cclxuICAgICAgICBcIlwiXCJcclxuICAgICAgZWxzZSBpZiAoZW50cnlJbmRleCA9PSAxKVxyXG4gICAgICAgIGh0bWwgKz0gXCJcIlwiXHJcbiAgICAgICAgICA8ZGl2IGNsYXNzPVwicmVzdFRpdGxlXCI+I3tyZXN0VGl0bGV9PC9kaXY+XHJcbiAgICAgICAgXCJcIlwiXHJcbiAgICBodG1sICs9IFwiXCJcIlxyXG4gICAgICA8ZGl2PiAqIDxhIHRhcmdldD1cIl9ibGFua1wiIGhyZWY9XCIje3VybH1cIj4je3RpdGxlfTwvYT4gPHNwYW4gY2xhc3M9XCJ1c2VyXCI+KCN7ZS51c2VyfSN7ZXh0cmFJbmZvfSk8L3NwYW4+PC9kaXY+XHJcblxyXG4gICAgXCJcIlwiXHJcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZG9tSUQpLmlubmVySFRNTCA9IGh0bWxcclxuXHJcblxyXG5zaG93TGlzdCA9IChkb21JRCwgZmlyc3RUaXRsZSwgcmVzdFRpdGxlLCB1cmwsIGlzTWFwID0gZmFsc2UpIC0+XHJcbiAgIyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbicpLmlubmVySFRNTCA9IFwiXCJcclxuICB4aHR0cCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpXHJcbiAgeGh0dHAub25yZWFkeXN0YXRlY2hhbmdlID0gLT5cclxuICAgICAgaWYgKEByZWFkeVN0YXRlID09IDQpIGFuZCAoQHN0YXR1cyA9PSAyMDApXHJcbiAgICAgICAgICMgVHlwaWNhbCBhY3Rpb24gdG8gYmUgcGVyZm9ybWVkIHdoZW4gdGhlIGRvY3VtZW50IGlzIHJlYWR5OlxyXG4gICAgICAgICB0cnlcclxuICAgICAgICAgICBlbnRyaWVzID0gSlNPTi5wYXJzZSh4aHR0cC5yZXNwb25zZVRleHQpXHJcbiAgICAgICAgICAgcmVuZGVyRW50cmllcyhkb21JRCwgZmlyc3RUaXRsZSwgcmVzdFRpdGxlLCBlbnRyaWVzLCBpc01hcClcclxuICAgICAgICAgY2F0Y2hcclxuICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1haW5cIikuaW5uZXJIVE1MID0gXCJFcnJvciFcIlxyXG4gIHhodHRwLm9wZW4oXCJHRVRcIiwgdXJsLCB0cnVlKVxyXG4gIHhodHRwLnNlbmQoKVxyXG5cclxuc2hvd0hpc3RvcnkgPSAtPlxyXG4gIHNob3dMaXN0KCdtYWluJywgXCJOb3cgUGxheWluZzpcIiwgXCJIaXN0b3J5OlwiLCBcIi9pbmZvL2hpc3RvcnlcIilcclxuICBsYXN0Q2xpY2tlZCA9IHNob3dIaXN0b3J5XHJcblxyXG5zaG93UXVldWUgPSAtPlxyXG4gIHNob3dMaXN0KCdtYWluJywgXCJVcCBOZXh0OlwiLCBcIlF1ZXVlOlwiLCBcIi9pbmZvL3F1ZXVlXCIpXHJcbiAgbGFzdENsaWNrZWQgPSBzaG93UXVldWVcclxuXHJcbnNob3dCb3RoID0gLT5cclxuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbicpLmlubmVySFRNTCA9IFwiXCJcIlxyXG4gICAgPGRpdiBpZD1cIm1haW5sXCI+PC9kaXY+XHJcbiAgICA8ZGl2IGlkPVwibWFpbnJcIj48L2Rpdj5cclxuICBcIlwiXCJcclxuICBzaG93TGlzdCgnbWFpbmwnLCBcIk5vdyBQbGF5aW5nOlwiLCBcIkhpc3Rvcnk6XCIsIFwiL2luZm8vaGlzdG9yeVwiKVxyXG4gIHNob3dMaXN0KCdtYWlucicsIFwiVXAgTmV4dDpcIiwgXCJRdWV1ZTpcIiwgXCIvaW5mby9xdWV1ZVwiKVxyXG4gIGxhc3RDbGlja2VkID0gc2hvd0JvdGhcclxuXHJcbnNob3dQbGF5bGlzdCA9IC0+XHJcbiAgc2hvd0xpc3QoJ21haW4nLCBudWxsLCBudWxsLCBcIi9pbmZvL3BsYXlsaXN0XCIsIHRydWUpXHJcbiAgbGFzdENsaWNrZWQgPSBzaG93UGxheWxpc3RcclxuXHJcbmNsYXNzIENhc3RQbGF5ZXJcclxuICBjb25zdHJ1Y3RvcjogLT5cclxuICAgIEByZW1vdGVQbGF5ZXIgPSBudWxsXHJcbiAgICBAcmVtb3RlUGxheWVyQ29udHJvbGxlciA9IG51bGxcclxuXHJcbiAgaW5pdGlhbGl6ZUNhc3RQbGF5ZXI6IC0+XHJcbiAgICBvcHRpb25zID1cclxuICAgICAgYXV0b0pvaW5Qb2xpY3k6IGNocm9tZS5jYXN0LkF1dG9Kb2luUG9saWN5Lk9SSUdJTl9TQ09QRURcclxuICAgICAgcmVjZWl2ZXJBcHBsaWNhdGlvbklkOiBjaHJvbWUuY2FzdC5tZWRpYS5ERUZBVUxUX01FRElBX1JFQ0VJVkVSX0FQUF9JRFxyXG4gICAgY2FzdC5mcmFtZXdvcmsuQ2FzdENvbnRleHQuZ2V0SW5zdGFuY2UoKS5zZXRPcHRpb25zKG9wdGlvbnMpXHJcbiAgICBAcmVtb3RlUGxheWVyID0gbmV3IGNhc3QuZnJhbWV3b3JrLlJlbW90ZVBsYXllcigpXHJcbiAgICBAcmVtb3RlUGxheWVyQ29udHJvbGxlciA9IG5ldyBjYXN0LmZyYW1ld29yay5SZW1vdGVQbGF5ZXJDb250cm9sbGVyKEByZW1vdGVQbGF5ZXIpXHJcbiAgICBAcmVtb3RlUGxheWVyQ29udHJvbGxlci5hZGRFdmVudExpc3RlbmVyKGNhc3QuZnJhbWV3b3JrLlJlbW90ZVBsYXllckV2ZW50VHlwZS5JU19DT05ORUNURURfQ0hBTkdFRCwgQHN3aXRjaFBsYXllci5iaW5kKHRoaXMpKVxyXG5cclxuICBzd2l0Y2hQbGF5ZXI6IC0+XHJcbiAgICBzZXNzaW9uU3RhdGUgPSBjYXN0LmZyYW1ld29yay5DYXN0Q29udGV4dC5nZXRJbnN0YW5jZSgpLmdldFNlc3Npb25TdGF0ZSgpXHJcbiAgICBpZiBzZXNzaW9uU3RhdGUgIT0gY2FzdC5mcmFtZXdvcmsuU2Vzc2lvblN0YXRlLlNFU1NJT05fU1RBUlRFRFxyXG4gICAgICBjb25zb2xlLmxvZyBcIlNlc3Npb24gZW5kZWQhXCJcclxuICAgICAgcmV0dXJuXHJcblxyXG4gICAgY29uc29sZS5sb2cgXCJTZXNzaW9uIHN0YXJ0aW5nIVwiXHJcbiAgICBzb2NrZXQuZW1pdCAnY2FzdHJlYWR5JywgeyBpZDogc29ja2V0LmlkIH1cclxuXHJcbmJlZ2luQ2FzdCA9IChwa3QpIC0+XHJcbiAgY29uc29sZS5sb2cgXCJDQVNUOlwiLCBwa3RcclxuXHJcbiAgc2Vzc2lvblN0YXRlID0gY2FzdC5mcmFtZXdvcmsuQ2FzdENvbnRleHQuZ2V0SW5zdGFuY2UoKS5nZXRTZXNzaW9uU3RhdGUoKVxyXG4gIGlmIHNlc3Npb25TdGF0ZSAhPSBjYXN0LmZyYW1ld29yay5TZXNzaW9uU3RhdGUuU0VTU0lPTl9TVEFSVEVEXHJcbiAgICBjb25zb2xlLmxvZyBcIk5vIHNlc3Npb247IHNraXBwaW5nIGJlZ2luQ2FzdFwiXHJcbiAgICByZXR1cm5cclxuXHJcbiAgY29uc29sZS5sb2cgXCJTdGFydGluZyBjYXN0IVwiXHJcbiAgY2FzdFNlc3Npb24gPSBjYXN0LmZyYW1ld29yay5DYXN0Q29udGV4dC5nZXRJbnN0YW5jZSgpLmdldEN1cnJlbnRTZXNzaW9uKClcclxuICBtZWRpYUluZm8gPSBuZXcgY2hyb21lLmNhc3QubWVkaWEuTWVkaWFJbmZvKHBrdC51cmwsICd2aWRlby9tcDQnKVxyXG4gIHJlcXVlc3QgPSBuZXcgY2hyb21lLmNhc3QubWVkaWEuTG9hZFJlcXVlc3QobWVkaWFJbmZvKVxyXG4gIGlmIHBrdC5zdGFydCA+IDBcclxuICAgIHJlcXVlc3QuY3VycmVudFRpbWUgPSBwa3Quc3RhcnRcclxuICBjYXN0U2Vzc2lvbi5sb2FkTWVkaWEocmVxdWVzdClcclxuXHJcbnByb2Nlc3NIYXNoID0gLT5cclxuICBjdXJyZW50SGFzaCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoXHJcbiAgc3dpdGNoIGN1cnJlbnRIYXNoXHJcbiAgICB3aGVuICcjcXVldWUnXHJcbiAgICAgIHNob3dRdWV1ZSgpXHJcbiAgICB3aGVuICcjYWxsJ1xyXG4gICAgICBzaG93UGxheWxpc3QoKVxyXG4gICAgd2hlbiAnI2JvdGgnXHJcbiAgICAgIHNob3dCb3RoKClcclxuICAgIGVsc2VcclxuICAgICAgc2hvd0hpc3RvcnkoKVxyXG5cclxuaW5pdCA9IC0+XHJcbiAgd2luZG93LnNob3dIaXN0b3J5ID0gc2hvd0hpc3RvcnlcclxuICB3aW5kb3cuc2hvd1F1ZXVlID0gc2hvd1F1ZXVlXHJcbiAgd2luZG93LnNob3dQbGF5bGlzdCA9IHNob3dQbGF5bGlzdFxyXG4gIHdpbmRvdy5vbmhhc2hjaGFuZ2UgPSBwcm9jZXNzSGFzaFxyXG5cclxuICBwcm9jZXNzSGFzaCgpXHJcblxyXG4gIHNvY2tldCA9IGlvKClcclxuICBzb2NrZXQub24gJ2Nhc3QnLCAocGt0KSAtPlxyXG4gICAgYmVnaW5DYXN0KHBrdClcclxuXHJcbiAgc29ja2V0Lm9uICdwbGF5JywgKHBrdCkgLT5cclxuICAgIGlmIGxhc3RDbGlja2VkP1xyXG4gICAgICBsYXN0Q2xpY2tlZCgpXHJcblxyXG4gIHdpbmRvdy5fX29uR0Nhc3RBcGlBdmFpbGFibGUgPSAoaXNBdmFpbGFibGUpIC0+XHJcbiAgICBjb25zb2xlLmxvZyBcIl9fb25HQ2FzdEFwaUF2YWlsYWJsZSBmaXJlZDogI3tpc0F2YWlsYWJsZX1cIlxyXG4gICAgY2FzdFBsYXllciA9IG5ldyBDYXN0UGxheWVyXHJcbiAgICBpZiBpc0F2YWlsYWJsZVxyXG4gICAgICBjYXN0UGxheWVyLmluaXRpYWxpemVDYXN0UGxheWVyKClcclxuXHJcbiAgY29uc29sZS5sb2cgXCJpbml0aWFsaXplZCFcIlxyXG5cclxud2luZG93Lm9ubG9hZCA9IGluaXRcclxuIl19
