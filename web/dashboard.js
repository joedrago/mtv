(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
var CastPlayer, beginCast, init, lastClicked, processHash, renderEntries, showBoth, showHistory, showList, showPlaylist, showQueue, showStats, socket, updateOther;

socket = null;

lastClicked = null;

renderEntries = function(domID, firstTitle, restTitle, entries, isMap) {
  var count, e, entryIndex, extraInfo, feeling, html, i, k, len, m, params, ref, title, url, v;
  html = "";
  if (isMap) {
    // console.log entries
    m = entries;
    entries = [];
    for (k in m) {
      v = m[k];
      entries.push(v);
    }
    // This is the "all" list, sort it
    entries.sort(function(a, b) {
      if (a.title < b.title) {
        return -1;
      }
      if (a.title > b.title) {
        return 1;
      }
      return 0;
    });
  }
  for (entryIndex = i = 0, len = entries.length; i < len; entryIndex = ++i) {
    e = entries[entryIndex];
    title = e.title;
    if (title == null) {
      title = e.id;
    }
    params = "";
    if (e.start >= 0) {
      params += params.length === 0 ? "?" : "&";
      params += `start=${e.start}`;
    }
    if (e.end >= 0) {
      params += params.length === 0 ? "?" : "&";
      params += `end=${e.end}`;
    }
    url = `https://youtu.be/${e.id}${params}`;
    extraInfo = "";
    if (e.countPlay != null) {
      extraInfo += `, ${e.countPlay} play${e.countPlay === 1 ? "" : "s"}`;
    }
    if (e.countSkip != null) {
      extraInfo += `, ${e.countSkip} skip${e.countSkip === 1 ? "" : "s"}`;
    }
    if (e.opinions != null) {
      ref = e.opinions;
      for (feeling in ref) {
        count = ref[feeling];
        extraInfo += `, ${count} ${feeling}${count === 1 ? "" : "s"}`;
      }
    }
    if (firstTitle != null) {
      if (entryIndex === 0) {
        html += `<div class="firstTitle">${firstTitle}</div>
<div class="previewContainer"><img class="preview" src="${e.thumb}"></div>`;
      } else if (entryIndex === 1) {
        html += `<div class="restTitle">${restTitle}</div>`;
      }
    }
    html += `<div> * <a target="_blank" href="${url}">${title}</a> <span class="user">(${e.user}${extraInfo})</span></div>
`;
  }
  return document.getElementById(domID).innerHTML = html;
};

showList = function(domID, firstTitle, restTitle, url, isMap = false) {
  var xhttp;
  // document.getElementById('main').innerHTML = ""
  xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    var entries;
    if ((this.readyState === 4) && (this.status === 200)) {
      try {
        // Typical action to be performed when the document is ready:
        entries = JSON.parse(xhttp.responseText);
        return renderEntries(domID, firstTitle, restTitle, entries, isMap);
      } catch (error) {
        return document.getElementById("main").innerHTML = "Error!";
      }
    }
  };
  xhttp.open("GET", url, true);
  return xhttp.send();
};

updateOther = function() {
  var xhttp;
  xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    var other;
    if ((this.readyState === 4) && (this.status === 200)) {
      try {
        // Typical action to be performed when the document is ready:
        other = JSON.parse(xhttp.responseText);
        return document.getElementById("playing").innerHTML = `(${other.playing} Watching)`;
      } catch (error) {

      }
    }
  };
  // nothing?
  xhttp.open("GET", "/info/other", true);
  return xhttp.send();
};

showHistory = function() {
  showList('main', "Now Playing:", "History:", "/info/history");
  updateOther();
  return lastClicked = showHistory;
};

showQueue = function() {
  showList('main', "Up Next:", "Queue:", "/info/queue");
  updateOther();
  return lastClicked = showQueue;
};

showBoth = function() {
  document.getElementById('main').innerHTML = `<div id="mainl"></div>
<div id="mainr"></div>`;
  showList('mainl', "Now Playing:", "History:", "/info/history");
  showList('mainr', "Up Next:", "Queue:", "/info/queue");
  updateOther();
  return lastClicked = showBoth;
};

showPlaylist = function() {
  showList('main', null, null, "/info/playlist", true);
  updateOther();
  return lastClicked = showPlaylist;
};

showStats = function() {
  var html, xhttp;
  html = "";
  xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    var amt, duration, e, endTime, entries, i, j, k, l, len, len1, len2, m, name, startTime, timeUnits, totalDuration, totalDurationString, unit, user, userCounts, userList, v;
    if ((this.readyState === 4) && (this.status === 200)) {
      try {
        // Typical action to be performed when the document is ready:
        entries = JSON.parse(xhttp.responseText);
        m = entries;
        entries = [];
        for (k in m) {
          v = m[k];
          entries.push(v);
        }
        totalDuration = 0;
        userCounts = {};
        for (i = 0, len = entries.length; i < len; i++) {
          e = entries[i];
          if (userCounts[name = e.user] == null) {
            userCounts[name] = 0;
          }
          userCounts[e.user] += 1;
          startTime = e.start;
          if (startTime < 0) {
            startTime = 0;
          }
          endTime = e.end;
          if (endTime < 0) {
            endTime = e.duration;
          }
          duration = endTime - startTime;
          totalDuration += duration;
        }
        userList = Object.keys(userCounts);
        userList.sort(function(a, b) {
          if (userCounts[a] < userCounts[b]) {
            return 1;
          }
          if (userCounts[a] > userCounts[b]) {
            return -1;
          }
          return 0;
        });
        totalDurationString = "";
        timeUnits = [
          {
            name: 'day',
            factor: 3600 * 24
          },
          {
            name: 'hour',
            factor: 3600
          },
          {
            name: 'min',
            factor: 60
          },
          {
            name: 'second',
            factor: 1
          }
        ];
        for (j = 0, len1 = timeUnits.length; j < len1; j++) {
          unit = timeUnits[j];
          if (totalDuration >= unit.factor) {
            amt = Math.floor(totalDuration / unit.factor);
            totalDuration -= amt * unit.factor;
            if (totalDurationString.length !== 0) {
              totalDurationString += ", ";
            }
            totalDurationString += `${amt} ${unit.name}${amt === 1 ? "" : "s"}`;
          }
        }
        html += `<div class="statsheader">Basic Stats:</div>
<div>Total Songs: ${entries.length}</div>
<div>Total Duration: ${totalDurationString}</div>

<div>&nbsp;</div>
<div class="statsheader">Songs by User:</div>`;
        for (l = 0, len2 = userList.length; l < len2; l++) {
          user = userList[l];
          html += `<div> * ${user}: ${userCounts[user]}</div>`;
        }
      } catch (error) {
        // html = "<pre>" + JSON.stringify(userCounts, null, 2) + "</pre>"
        html = "Error!";
      }
    }
    return document.getElementById("main").innerHTML = html;
  };
  xhttp.open("GET", "/info/playlist", true);
  xhttp.send();
  updateOther();
  return lastClicked = showStats;
};

CastPlayer = class CastPlayer {
  constructor() {
    this.remotePlayer = null;
    this.remotePlayerController = null;
  }

  initializeCastPlayer() {
    var options;
    options = {
      autoJoinPolicy: chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED,
      receiverApplicationId: chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID
    };
    cast.framework.CastContext.getInstance().setOptions(options);
    this.remotePlayer = new cast.framework.RemotePlayer();
    this.remotePlayerController = new cast.framework.RemotePlayerController(this.remotePlayer);
    return this.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.IS_CONNECTED_CHANGED, this.switchPlayer.bind(this));
  }

  switchPlayer() {
    var sessionState;
    sessionState = cast.framework.CastContext.getInstance().getSessionState();
    if (sessionState !== cast.framework.SessionState.SESSION_STARTED) {
      console.log("Session ended!");
      return;
    }
    console.log("Session starting!");
    return socket.emit('castready', {
      id: socket.id
    });
  }

};

beginCast = function(pkt) {
  var castSession, mediaInfo, request, sessionState;
  console.log("CAST:", pkt);
  sessionState = cast.framework.CastContext.getInstance().getSessionState();
  if (sessionState !== cast.framework.SessionState.SESSION_STARTED) {
    console.log("No session; skipping beginCast");
    return;
  }
  console.log("Starting cast!");
  castSession = cast.framework.CastContext.getInstance().getCurrentSession();
  mediaInfo = new chrome.cast.media.MediaInfo(pkt.url, 'video/mp4');
  request = new chrome.cast.media.LoadRequest(mediaInfo);
  if (pkt.start > 0) {
    request.currentTime = pkt.start;
  }
  return castSession.loadMedia(request);
};

processHash = function() {
  var currentHash;
  currentHash = window.location.hash;
  switch (currentHash) {
    case '#queue':
      return showQueue();
    case '#all':
      return showPlaylist();
    case '#both':
      return showBoth();
    case '#stats':
      return showStats();
    default:
      return showHistory();
  }
};

init = function() {
  window.showHistory = showHistory;
  window.showQueue = showQueue;
  window.showPlaylist = showPlaylist;
  window.showBoth = showBoth;
  window.showStats = showStats;
  window.onhashchange = processHash;
  processHash();
  socket = io();
  socket.on('cast', function(pkt) {
    return beginCast(pkt);
  });
  socket.on('play', function(pkt) {
    if (lastClicked != null) {
      return lastClicked();
    }
  });
  socket.on('refresh', function(pkt) {
    if (lastClicked != null) {
      return lastClicked();
    }
  });
  window.__onGCastApiAvailable = function(isAvailable) {
    var castPlayer;
    console.log(`__onGCastApiAvailable fired: ${isAvailable}`);
    castPlayer = new CastPlayer();
    if (isAvailable) {
      return castPlayer.initializeCastPlayer();
    }
  };
  return console.log("initialized!");
};

window.onload = init;


},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvY2xpZW50L2Rhc2hib2FyZC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQSxJQUFBLFVBQUEsRUFBQSxTQUFBLEVBQUEsSUFBQSxFQUFBLFdBQUEsRUFBQSxXQUFBLEVBQUEsYUFBQSxFQUFBLFFBQUEsRUFBQSxXQUFBLEVBQUEsUUFBQSxFQUFBLFlBQUEsRUFBQSxTQUFBLEVBQUEsU0FBQSxFQUFBLE1BQUEsRUFBQTs7QUFBQSxNQUFBLEdBQVM7O0FBRVQsV0FBQSxHQUFjOztBQUVkLGFBQUEsR0FBZ0IsUUFBQSxDQUFDLEtBQUQsRUFBUSxVQUFSLEVBQW9CLFNBQXBCLEVBQStCLE9BQS9CLEVBQXdDLEtBQXhDLENBQUE7QUFDaEIsTUFBQSxLQUFBLEVBQUEsQ0FBQSxFQUFBLFVBQUEsRUFBQSxTQUFBLEVBQUEsT0FBQSxFQUFBLElBQUEsRUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLEdBQUEsRUFBQSxDQUFBLEVBQUEsTUFBQSxFQUFBLEdBQUEsRUFBQSxLQUFBLEVBQUEsR0FBQSxFQUFBO0VBQUUsSUFBQSxHQUFPO0VBRVAsSUFBRyxLQUFIOztJQUVFLENBQUEsR0FBSTtJQUNKLE9BQUEsR0FBVTtJQUNWLEtBQUEsTUFBQTs7TUFDRSxPQUFPLENBQUMsSUFBUixDQUFhLENBQWI7SUFERixDQUhKOztJQU9JLE9BQU8sQ0FBQyxJQUFSLENBQWEsUUFBQSxDQUFDLENBQUQsRUFBSSxDQUFKLENBQUE7TUFDWCxJQUFHLENBQUMsQ0FBQyxLQUFGLEdBQVUsQ0FBQyxDQUFDLEtBQWY7QUFDRSxlQUFPLENBQUMsRUFEVjs7TUFFQSxJQUFHLENBQUMsQ0FBQyxLQUFGLEdBQVUsQ0FBQyxDQUFDLEtBQWY7QUFDRSxlQUFPLEVBRFQ7O0FBRUEsYUFBTztJQUxJLENBQWIsRUFSRjs7RUFlQSxLQUFBLG1FQUFBOztJQUNFLEtBQUEsR0FBUSxDQUFDLENBQUM7SUFD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QU0sQ0FBQyxTQUFQLEdBQW1CO0VBQ25CLE1BQU0sQ0FBQyxZQUFQLEdBQXNCO0VBQ3RCLE1BQU0sQ0FBQyxRQUFQLEdBQWtCO0VBQ2xCLE1BQU0sQ0FBQyxTQUFQLEdBQW1CO0VBQ25CLE1BQU0sQ0FBQyxZQUFQLEdBQXNCO0VBRXRCLFdBQUEsQ0FBQTtFQUVBLE1BQUEsR0FBUyxFQUFBLENBQUE7RUFDVCxNQUFNLENBQUMsRUFBUCxDQUFVLE1BQVYsRUFBa0IsUUFBQSxDQUFDLEdBQUQsQ0FBQTtXQUNoQixTQUFBLENBQVUsR0FBVjtFQURnQixDQUFsQjtFQUdBLE1BQU0sQ0FBQyxFQUFQLENBQVUsTUFBVixFQUFrQixRQUFBLENBQUMsR0FBRCxDQUFBO0lBQ2hCLElBQUcsbUJBQUg7YUFDRSxXQUFBLENBQUEsRUFERjs7RUFEZ0IsQ0FBbEI7RUFJQSxNQUFNLENBQUMsRUFBUCxDQUFVLFNBQVYsRUFBcUIsUUFBQSxDQUFDLEdBQUQsQ0FBQTtJQUNuQixJQUFHLG1CQUFIO2FBQ0UsV0FBQSxDQUFBLEVBREY7O0VBRG1CLENBQXJCO0VBSUEsTUFBTSxDQUFDLHFCQUFQLEdBQStCLFFBQUEsQ0FBQyxXQUFELENBQUE7QUFDakMsUUFBQTtJQUFJLE9BQU8sQ0FBQyxHQUFSLENBQVksQ0FBQSw2QkFBQSxDQUFBLENBQWdDLFdBQWhDLENBQUEsQ0FBWjtJQUNBLFVBQUEsR0FBYSxJQUFJLFVBQUosQ0FBQTtJQUNiLElBQUcsV0FBSDthQUNFLFVBQVUsQ0FBQyxvQkFBWCxDQUFBLEVBREY7O0VBSDZCO1NBTS9CLE9BQU8sQ0FBQyxHQUFSLENBQVksY0FBWjtBQTVCSzs7QUE4QlAsTUFBTSxDQUFDLE1BQVAsR0FBZ0IiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJzb2NrZXQgPSBudWxsXHJcblxyXG5sYXN0Q2xpY2tlZCA9IG51bGxcclxuXHJcbnJlbmRlckVudHJpZXMgPSAoZG9tSUQsIGZpcnN0VGl0bGUsIHJlc3RUaXRsZSwgZW50cmllcywgaXNNYXApIC0+XHJcbiAgaHRtbCA9IFwiXCJcclxuXHJcbiAgaWYgaXNNYXBcclxuICAgICMgY29uc29sZS5sb2cgZW50cmllc1xyXG4gICAgbSA9IGVudHJpZXNcclxuICAgIGVudHJpZXMgPSBbXVxyXG4gICAgZm9yIGssIHYgb2YgbVxyXG4gICAgICBlbnRyaWVzLnB1c2ggdlxyXG5cclxuICAgICMgVGhpcyBpcyB0aGUgXCJhbGxcIiBsaXN0LCBzb3J0IGl0XHJcbiAgICBlbnRyaWVzLnNvcnQgKGEsIGIpIC0+XHJcbiAgICAgIGlmIGEudGl0bGUgPCBiLnRpdGxlXHJcbiAgICAgICAgcmV0dXJuIC0xXHJcbiAgICAgIGlmIGEudGl0bGUgPiBiLnRpdGxlXHJcbiAgICAgICAgcmV0dXJuIDFcclxuICAgICAgcmV0dXJuIDBcclxuXHJcbiAgZm9yIGUsIGVudHJ5SW5kZXggaW4gZW50cmllc1xyXG4gICAgdGl0bGUgPSBlLnRpdGxlXHJcbiAgICBpZiBub3QgdGl0bGU/XHJcbiAgICAgIHRpdGxlID0gZS5pZFxyXG4gICAgcGFyYW1zID0gXCJcIlxyXG4gICAgaWYgZS5zdGFydCA+PSAwXHJcbiAgICAgIHBhcmFtcyArPSBpZiBwYXJhbXMubGVuZ3RoID09IDAgdGhlbiBcIj9cIiBlbHNlIFwiJlwiXHJcbiAgICAgIHBhcmFtcyArPSBcInN0YXJ0PSN7ZS5zdGFydH1cIlxyXG4gICAgaWYgZS5lbmQgPj0gMFxyXG4gICAgICBwYXJhbXMgKz0gaWYgcGFyYW1zLmxlbmd0aCA9PSAwIHRoZW4gXCI/XCIgZWxzZSBcIiZcIlxyXG4gICAgICBwYXJhbXMgKz0gXCJlbmQ9I3tlLmVuZH1cIlxyXG4gICAgdXJsID0gXCJodHRwczovL3lvdXR1LmJlLyN7ZS5pZH0je3BhcmFtc31cIlxyXG4gICAgZXh0cmFJbmZvID0gXCJcIlxyXG4gICAgaWYgZS5jb3VudFBsYXk/XHJcbiAgICAgIGV4dHJhSW5mbyArPSBcIiwgI3tlLmNvdW50UGxheX0gcGxheSN7aWYgZS5jb3VudFBsYXkgPT0gMSB0aGVuIFwiXCIgZWxzZSBcInNcIn1cIlxyXG4gICAgaWYgZS5jb3VudFNraXA/XHJcbiAgICAgIGV4dHJhSW5mbyArPSBcIiwgI3tlLmNvdW50U2tpcH0gc2tpcCN7aWYgZS5jb3VudFNraXAgPT0gMSB0aGVuIFwiXCIgZWxzZSBcInNcIn1cIlxyXG5cclxuICAgIGlmIGUub3BpbmlvbnM/XHJcbiAgICAgIGZvciBmZWVsaW5nLCBjb3VudCBvZiBlLm9waW5pb25zXHJcbiAgICAgICAgZXh0cmFJbmZvICs9IFwiLCAje2NvdW50fSAje2ZlZWxpbmd9I3tpZiBjb3VudCA9PSAxIHRoZW4gXCJcIiBlbHNlIFwic1wifVwiXHJcblxyXG4gICAgaWYgZmlyc3RUaXRsZT9cclxuICAgICAgaWYgKGVudHJ5SW5kZXggPT0gMClcclxuICAgICAgICBodG1sICs9IFwiXCJcIlxyXG4gICAgICAgICAgPGRpdiBjbGFzcz1cImZpcnN0VGl0bGVcIj4je2ZpcnN0VGl0bGV9PC9kaXY+XHJcbiAgICAgICAgICA8ZGl2IGNsYXNzPVwicHJldmlld0NvbnRhaW5lclwiPjxpbWcgY2xhc3M9XCJwcmV2aWV3XCIgc3JjPVwiI3tlLnRodW1ifVwiPjwvZGl2PlxyXG4gICAgICAgIFwiXCJcIlxyXG4gICAgICBlbHNlIGlmIChlbnRyeUluZGV4ID09IDEpXHJcbiAgICAgICAgaHRtbCArPSBcIlwiXCJcclxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJyZXN0VGl0bGVcIj4je3Jlc3RUaXRsZX08L2Rpdj5cclxuICAgICAgICBcIlwiXCJcclxuICAgIGh0bWwgKz0gXCJcIlwiXHJcbiAgICAgIDxkaXY+ICogPGEgdGFyZ2V0PVwiX2JsYW5rXCIgaHJlZj1cIiN7dXJsfVwiPiN7dGl0bGV9PC9hPiA8c3BhbiBjbGFzcz1cInVzZXJcIj4oI3tlLnVzZXJ9I3tleHRyYUluZm99KTwvc3Bhbj48L2Rpdj5cclxuXHJcbiAgICBcIlwiXCJcclxuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChkb21JRCkuaW5uZXJIVE1MID0gaHRtbFxyXG5cclxuXHJcbnNob3dMaXN0ID0gKGRvbUlELCBmaXJzdFRpdGxlLCByZXN0VGl0bGUsIHVybCwgaXNNYXAgPSBmYWxzZSkgLT5cclxuICAjIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluJykuaW5uZXJIVE1MID0gXCJcIlxyXG4gIHhodHRwID0gbmV3IFhNTEh0dHBSZXF1ZXN0KClcclxuICB4aHR0cC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSAtPlxyXG4gICAgICBpZiAoQHJlYWR5U3RhdGUgPT0gNCkgYW5kIChAc3RhdHVzID09IDIwMClcclxuICAgICAgICAgIyBUeXBpY2FsIGFjdGlvbiB0byBiZSBwZXJmb3JtZWQgd2hlbiB0aGUgZG9jdW1lbnQgaXMgcmVhZHk6XHJcbiAgICAgICAgIHRyeVxyXG4gICAgICAgICAgIGVudHJpZXMgPSBKU09OLnBhcnNlKHhodHRwLnJlc3BvbnNlVGV4dClcclxuICAgICAgICAgICByZW5kZXJFbnRyaWVzKGRvbUlELCBmaXJzdFRpdGxlLCByZXN0VGl0bGUsIGVudHJpZXMsIGlzTWFwKVxyXG4gICAgICAgICBjYXRjaFxyXG4gICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibWFpblwiKS5pbm5lckhUTUwgPSBcIkVycm9yIVwiXHJcbiAgeGh0dHAub3BlbihcIkdFVFwiLCB1cmwsIHRydWUpXHJcbiAgeGh0dHAuc2VuZCgpXHJcblxyXG51cGRhdGVPdGhlciA9IC0+XHJcbiAgeGh0dHAgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKVxyXG4gIHhodHRwLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IC0+XHJcbiAgICAgIGlmIChAcmVhZHlTdGF0ZSA9PSA0KSBhbmQgKEBzdGF0dXMgPT0gMjAwKVxyXG4gICAgICAgICAjIFR5cGljYWwgYWN0aW9uIHRvIGJlIHBlcmZvcm1lZCB3aGVuIHRoZSBkb2N1bWVudCBpcyByZWFkeTpcclxuICAgICAgICAgdHJ5XHJcbiAgICAgICAgICAgb3RoZXIgPSBKU09OLnBhcnNlKHhodHRwLnJlc3BvbnNlVGV4dClcclxuICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInBsYXlpbmdcIikuaW5uZXJIVE1MID0gXCIoI3tvdGhlci5wbGF5aW5nfSBXYXRjaGluZylcIlxyXG4gICAgICAgICBjYXRjaFxyXG4gICAgICAgICAgICMgbm90aGluZz9cclxuICB4aHR0cC5vcGVuKFwiR0VUXCIsIFwiL2luZm8vb3RoZXJcIiwgdHJ1ZSlcclxuICB4aHR0cC5zZW5kKClcclxuXHJcbnNob3dIaXN0b3J5ID0gLT5cclxuICBzaG93TGlzdCgnbWFpbicsIFwiTm93IFBsYXlpbmc6XCIsIFwiSGlzdG9yeTpcIiwgXCIvaW5mby9oaXN0b3J5XCIpXHJcbiAgdXBkYXRlT3RoZXIoKVxyXG4gIGxhc3RDbGlja2VkID0gc2hvd0hpc3RvcnlcclxuXHJcbnNob3dRdWV1ZSA9IC0+XHJcbiAgc2hvd0xpc3QoJ21haW4nLCBcIlVwIE5leHQ6XCIsIFwiUXVldWU6XCIsIFwiL2luZm8vcXVldWVcIilcclxuICB1cGRhdGVPdGhlcigpXHJcbiAgbGFzdENsaWNrZWQgPSBzaG93UXVldWVcclxuXHJcbnNob3dCb3RoID0gLT5cclxuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbicpLmlubmVySFRNTCA9IFwiXCJcIlxyXG4gICAgPGRpdiBpZD1cIm1haW5sXCI+PC9kaXY+XHJcbiAgICA8ZGl2IGlkPVwibWFpbnJcIj48L2Rpdj5cclxuICBcIlwiXCJcclxuICBzaG93TGlzdCgnbWFpbmwnLCBcIk5vdyBQbGF5aW5nOlwiLCBcIkhpc3Rvcnk6XCIsIFwiL2luZm8vaGlzdG9yeVwiKVxyXG4gIHNob3dMaXN0KCdtYWlucicsIFwiVXAgTmV4dDpcIiwgXCJRdWV1ZTpcIiwgXCIvaW5mby9xdWV1ZVwiKVxyXG4gIHVwZGF0ZU90aGVyKClcclxuICBsYXN0Q2xpY2tlZCA9IHNob3dCb3RoXHJcblxyXG5zaG93UGxheWxpc3QgPSAtPlxyXG4gIHNob3dMaXN0KCdtYWluJywgbnVsbCwgbnVsbCwgXCIvaW5mby9wbGF5bGlzdFwiLCB0cnVlKVxyXG4gIHVwZGF0ZU90aGVyKClcclxuICBsYXN0Q2xpY2tlZCA9IHNob3dQbGF5bGlzdFxyXG5cclxuc2hvd1N0YXRzID0gLT5cclxuICBodG1sID0gXCJcIlxyXG4gIHhodHRwID0gbmV3IFhNTEh0dHBSZXF1ZXN0KClcclxuICB4aHR0cC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSAtPlxyXG4gICAgaWYgKEByZWFkeVN0YXRlID09IDQpIGFuZCAoQHN0YXR1cyA9PSAyMDApXHJcbiAgICAgICAjIFR5cGljYWwgYWN0aW9uIHRvIGJlIHBlcmZvcm1lZCB3aGVuIHRoZSBkb2N1bWVudCBpcyByZWFkeTpcclxuICAgICAgIHRyeVxyXG4gICAgICAgICAgZW50cmllcyA9IEpTT04ucGFyc2UoeGh0dHAucmVzcG9uc2VUZXh0KVxyXG4gICAgICAgICAgbSA9IGVudHJpZXNcclxuICAgICAgICAgIGVudHJpZXMgPSBbXVxyXG4gICAgICAgICAgZm9yIGssIHYgb2YgbVxyXG4gICAgICAgICAgICBlbnRyaWVzLnB1c2ggdlxyXG5cclxuICAgICAgICAgIHRvdGFsRHVyYXRpb24gPSAwXHJcblxyXG4gICAgICAgICAgdXNlckNvdW50cyA9IHt9XHJcbiAgICAgICAgICBmb3IgZSBpbiBlbnRyaWVzXHJcbiAgICAgICAgICAgIHVzZXJDb3VudHNbZS51c2VyXSA/PSAwXHJcbiAgICAgICAgICAgIHVzZXJDb3VudHNbZS51c2VyXSArPSAxXHJcbiAgICAgICAgICAgIHN0YXJ0VGltZSA9IGUuc3RhcnRcclxuICAgICAgICAgICAgaWYgc3RhcnRUaW1lIDwgMFxyXG4gICAgICAgICAgICAgIHN0YXJ0VGltZSA9IDBcclxuICAgICAgICAgICAgZW5kVGltZSA9IGUuZW5kXHJcbiAgICAgICAgICAgIGlmIGVuZFRpbWUgPCAwXHJcbiAgICAgICAgICAgICAgZW5kVGltZSA9IGUuZHVyYXRpb25cclxuICAgICAgICAgICAgZHVyYXRpb24gPSBlbmRUaW1lIC0gc3RhcnRUaW1lXHJcbiAgICAgICAgICAgIHRvdGFsRHVyYXRpb24gKz0gZHVyYXRpb25cclxuXHJcbiAgICAgICAgICB1c2VyTGlzdCA9IE9iamVjdC5rZXlzKHVzZXJDb3VudHMpXHJcbiAgICAgICAgICB1c2VyTGlzdC5zb3J0IChhLCBiKSAtPlxyXG4gICAgICAgICAgICBpZiB1c2VyQ291bnRzW2FdIDwgdXNlckNvdW50c1tiXVxyXG4gICAgICAgICAgICAgIHJldHVybiAxXHJcbiAgICAgICAgICAgIGlmIHVzZXJDb3VudHNbYV0gPiB1c2VyQ291bnRzW2JdXHJcbiAgICAgICAgICAgICAgcmV0dXJuIC0xXHJcbiAgICAgICAgICAgIHJldHVybiAwXHJcblxyXG4gICAgICAgICAgdG90YWxEdXJhdGlvblN0cmluZyA9IFwiXCJcclxuICAgICAgICAgIHRpbWVVbml0cyA9IFtcclxuICAgICAgICAgICAgeyBuYW1lOiAnZGF5JywgZmFjdG9yOiAzNjAwICogMjQgfVxyXG4gICAgICAgICAgICB7IG5hbWU6ICdob3VyJywgZmFjdG9yOiAzNjAwIH1cclxuICAgICAgICAgICAgeyBuYW1lOiAnbWluJywgZmFjdG9yOiA2MCB9XHJcbiAgICAgICAgICAgIHsgbmFtZTogJ3NlY29uZCcsIGZhY3RvcjogMSB9XHJcbiAgICAgICAgICBdXHJcbiAgICAgICAgICBmb3IgdW5pdCBpbiB0aW1lVW5pdHNcclxuICAgICAgICAgICAgaWYgdG90YWxEdXJhdGlvbiA+PSB1bml0LmZhY3RvclxyXG4gICAgICAgICAgICAgIGFtdCA9IE1hdGguZmxvb3IodG90YWxEdXJhdGlvbiAvIHVuaXQuZmFjdG9yKVxyXG4gICAgICAgICAgICAgIHRvdGFsRHVyYXRpb24gLT0gYW10ICogdW5pdC5mYWN0b3JcclxuICAgICAgICAgICAgICBpZiB0b3RhbER1cmF0aW9uU3RyaW5nLmxlbmd0aCAhPSAwXHJcbiAgICAgICAgICAgICAgICB0b3RhbER1cmF0aW9uU3RyaW5nICs9IFwiLCBcIlxyXG4gICAgICAgICAgICAgIHRvdGFsRHVyYXRpb25TdHJpbmcgKz0gXCIje2FtdH0gI3t1bml0Lm5hbWV9I3tpZiBhbXQgPT0gMSB0aGVuIFwiXCIgZWxzZSBcInNcIn1cIlxyXG5cclxuICAgICAgICAgIGh0bWwgKz0gXCJcIlwiXHJcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJzdGF0c2hlYWRlclwiPkJhc2ljIFN0YXRzOjwvZGl2PlxyXG4gICAgICAgICAgICA8ZGl2PlRvdGFsIFNvbmdzOiAje2VudHJpZXMubGVuZ3RofTwvZGl2PlxyXG4gICAgICAgICAgICA8ZGl2PlRvdGFsIER1cmF0aW9uOiAje3RvdGFsRHVyYXRpb25TdHJpbmd9PC9kaXY+XHJcblxyXG4gICAgICAgICAgICA8ZGl2PiZuYnNwOzwvZGl2PlxyXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwic3RhdHNoZWFkZXJcIj5Tb25ncyBieSBVc2VyOjwvZGl2PlxyXG4gICAgICAgICAgXCJcIlwiXHJcbiAgICAgICAgICBmb3IgdXNlciBpbiB1c2VyTGlzdFxyXG4gICAgICAgICAgICBodG1sICs9IFwiXCJcIlxyXG4gICAgICAgICAgICAgIDxkaXY+ICogI3t1c2VyfTogI3t1c2VyQ291bnRzW3VzZXJdfTwvZGl2PlxyXG4gICAgICAgICAgICBcIlwiXCJcclxuXHJcbiAgICAgICAgICAjIGh0bWwgPSBcIjxwcmU+XCIgKyBKU09OLnN0cmluZ2lmeSh1c2VyQ291bnRzLCBudWxsLCAyKSArIFwiPC9wcmU+XCJcclxuXHJcbiAgICAgICBjYXRjaFxyXG4gICAgICAgICBodG1sID0gXCJFcnJvciFcIlxyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtYWluXCIpLmlubmVySFRNTCA9IGh0bWxcclxuICB4aHR0cC5vcGVuKFwiR0VUXCIsIFwiL2luZm8vcGxheWxpc3RcIiwgdHJ1ZSlcclxuICB4aHR0cC5zZW5kKClcclxuXHJcbiAgdXBkYXRlT3RoZXIoKVxyXG4gIGxhc3RDbGlja2VkID0gc2hvd1N0YXRzXHJcblxyXG5jbGFzcyBDYXN0UGxheWVyXHJcbiAgY29uc3RydWN0b3I6IC0+XHJcbiAgICBAcmVtb3RlUGxheWVyID0gbnVsbFxyXG4gICAgQHJlbW90ZVBsYXllckNvbnRyb2xsZXIgPSBudWxsXHJcblxyXG4gIGluaXRpYWxpemVDYXN0UGxheWVyOiAtPlxyXG4gICAgb3B0aW9ucyA9XHJcbiAgICAgIGF1dG9Kb2luUG9saWN5OiBjaHJvbWUuY2FzdC5BdXRvSm9pblBvbGljeS5PUklHSU5fU0NPUEVEXHJcbiAgICAgIHJlY2VpdmVyQXBwbGljYXRpb25JZDogY2hyb21lLmNhc3QubWVkaWEuREVGQVVMVF9NRURJQV9SRUNFSVZFUl9BUFBfSURcclxuICAgIGNhc3QuZnJhbWV3b3JrLkNhc3RDb250ZXh0LmdldEluc3RhbmNlKCkuc2V0T3B0aW9ucyhvcHRpb25zKVxyXG4gICAgQHJlbW90ZVBsYXllciA9IG5ldyBjYXN0LmZyYW1ld29yay5SZW1vdGVQbGF5ZXIoKVxyXG4gICAgQHJlbW90ZVBsYXllckNvbnRyb2xsZXIgPSBuZXcgY2FzdC5mcmFtZXdvcmsuUmVtb3RlUGxheWVyQ29udHJvbGxlcihAcmVtb3RlUGxheWVyKVxyXG4gICAgQHJlbW90ZVBsYXllckNvbnRyb2xsZXIuYWRkRXZlbnRMaXN0ZW5lcihjYXN0LmZyYW1ld29yay5SZW1vdGVQbGF5ZXJFdmVudFR5cGUuSVNfQ09OTkVDVEVEX0NIQU5HRUQsIEBzd2l0Y2hQbGF5ZXIuYmluZCh0aGlzKSlcclxuXHJcbiAgc3dpdGNoUGxheWVyOiAtPlxyXG4gICAgc2Vzc2lvblN0YXRlID0gY2FzdC5mcmFtZXdvcmsuQ2FzdENvbnRleHQuZ2V0SW5zdGFuY2UoKS5nZXRTZXNzaW9uU3RhdGUoKVxyXG4gICAgaWYgc2Vzc2lvblN0YXRlICE9IGNhc3QuZnJhbWV3b3JrLlNlc3Npb25TdGF0ZS5TRVNTSU9OX1NUQVJURURcclxuICAgICAgY29uc29sZS5sb2cgXCJTZXNzaW9uIGVuZGVkIVwiXHJcbiAgICAgIHJldHVyblxyXG5cclxuICAgIGNvbnNvbGUubG9nIFwiU2Vzc2lvbiBzdGFydGluZyFcIlxyXG4gICAgc29ja2V0LmVtaXQgJ2Nhc3RyZWFkeScsIHsgaWQ6IHNvY2tldC5pZCB9XHJcblxyXG5iZWdpbkNhc3QgPSAocGt0KSAtPlxyXG4gIGNvbnNvbGUubG9nIFwiQ0FTVDpcIiwgcGt0XHJcblxyXG4gIHNlc3Npb25TdGF0ZSA9IGNhc3QuZnJhbWV3b3JrLkNhc3RDb250ZXh0LmdldEluc3RhbmNlKCkuZ2V0U2Vzc2lvblN0YXRlKClcclxuICBpZiBzZXNzaW9uU3RhdGUgIT0gY2FzdC5mcmFtZXdvcmsuU2Vzc2lvblN0YXRlLlNFU1NJT05fU1RBUlRFRFxyXG4gICAgY29uc29sZS5sb2cgXCJObyBzZXNzaW9uOyBza2lwcGluZyBiZWdpbkNhc3RcIlxyXG4gICAgcmV0dXJuXHJcblxyXG4gIGNvbnNvbGUubG9nIFwiU3RhcnRpbmcgY2FzdCFcIlxyXG4gIGNhc3RTZXNzaW9uID0gY2FzdC5mcmFtZXdvcmsuQ2FzdENvbnRleHQuZ2V0SW5zdGFuY2UoKS5nZXRDdXJyZW50U2Vzc2lvbigpXHJcbiAgbWVkaWFJbmZvID0gbmV3IGNocm9tZS5jYXN0Lm1lZGlhLk1lZGlhSW5mbyhwa3QudXJsLCAndmlkZW8vbXA0JylcclxuICByZXF1ZXN0ID0gbmV3IGNocm9tZS5jYXN0Lm1lZGlhLkxvYWRSZXF1ZXN0KG1lZGlhSW5mbylcclxuICBpZiBwa3Quc3RhcnQgPiAwXHJcbiAgICByZXF1ZXN0LmN1cnJlbnRUaW1lID0gcGt0LnN0YXJ0XHJcbiAgY2FzdFNlc3Npb24ubG9hZE1lZGlhKHJlcXVlc3QpXHJcblxyXG5wcm9jZXNzSGFzaCA9IC0+XHJcbiAgY3VycmVudEhhc2ggPSB3aW5kb3cubG9jYXRpb24uaGFzaFxyXG4gIHN3aXRjaCBjdXJyZW50SGFzaFxyXG4gICAgd2hlbiAnI3F1ZXVlJ1xyXG4gICAgICBzaG93UXVldWUoKVxyXG4gICAgd2hlbiAnI2FsbCdcclxuICAgICAgc2hvd1BsYXlsaXN0KClcclxuICAgIHdoZW4gJyNib3RoJ1xyXG4gICAgICBzaG93Qm90aCgpXHJcbiAgICB3aGVuICcjc3RhdHMnXHJcbiAgICAgIHNob3dTdGF0cygpXHJcbiAgICBlbHNlXHJcbiAgICAgIHNob3dIaXN0b3J5KClcclxuXHJcbmluaXQgPSAtPlxyXG4gIHdpbmRvdy5zaG93SGlzdG9yeSA9IHNob3dIaXN0b3J5XHJcbiAgd2luZG93LnNob3dRdWV1ZSA9IHNob3dRdWV1ZVxyXG4gIHdpbmRvdy5zaG93UGxheWxpc3QgPSBzaG93UGxheWxpc3RcclxuICB3aW5kb3cuc2hvd0JvdGggPSBzaG93Qm90aFxyXG4gIHdpbmRvdy5zaG93U3RhdHMgPSBzaG93U3RhdHNcclxuICB3aW5kb3cub25oYXNoY2hhbmdlID0gcHJvY2Vzc0hhc2hcclxuXHJcbiAgcHJvY2Vzc0hhc2goKVxyXG5cclxuICBzb2NrZXQgPSBpbygpXHJcbiAgc29ja2V0Lm9uICdjYXN0JywgKHBrdCkgLT5cclxuICAgIGJlZ2luQ2FzdChwa3QpXHJcblxyXG4gIHNvY2tldC5vbiAncGxheScsIChwa3QpIC0+XHJcbiAgICBpZiBsYXN0Q2xpY2tlZD9cclxuICAgICAgbGFzdENsaWNrZWQoKVxyXG5cclxuICBzb2NrZXQub24gJ3JlZnJlc2gnLCAocGt0KSAtPlxyXG4gICAgaWYgbGFzdENsaWNrZWQ/XHJcbiAgICAgIGxhc3RDbGlja2VkKClcclxuXHJcbiAgd2luZG93Ll9fb25HQ2FzdEFwaUF2YWlsYWJsZSA9IChpc0F2YWlsYWJsZSkgLT5cclxuICAgIGNvbnNvbGUubG9nIFwiX19vbkdDYXN0QXBpQXZhaWxhYmxlIGZpcmVkOiAje2lzQXZhaWxhYmxlfVwiXHJcbiAgICBjYXN0UGxheWVyID0gbmV3IENhc3RQbGF5ZXJcclxuICAgIGlmIGlzQXZhaWxhYmxlXHJcbiAgICAgIGNhc3RQbGF5ZXIuaW5pdGlhbGl6ZUNhc3RQbGF5ZXIoKVxyXG5cclxuICBjb25zb2xlLmxvZyBcImluaXRpYWxpemVkIVwiXHJcblxyXG53aW5kb3cub25sb2FkID0gaW5pdFxyXG4iXX0=
