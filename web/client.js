(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
var context, doneWaiting, endedTimer, fatal, onPlayerReady, onPlayerStateChange, play, player, playerManager, playing, serverEpoch, socket, tick;

player = null;

socket = null;

playing = false;

serverEpoch = null;

endedTimer = null;

fatal = function(reason) {
  var d;
  d = document.getElementById('pleasewait');
  d.style.display = 'block';
  return d.innerHTML = reason;
};

doneWaiting = function() {
  var d;
  d = document.getElementById('pleasewait');
  return d.style.display = 'none';
};

// autoplay video
onPlayerReady = function(event) {
  return event.target.playVideo();
};

// when video ends
onPlayerStateChange = function(event) {
  var videoData;
  if (endedTimer != null) {
    clearTimeout(endedTimer);
    endedTimer = null;
  }
  videoData = player.getVideoData();
  if ((videoData != null) && (videoData.title != null)) {
    console.log(`Title: ${videoData.title}`);
    window.document.title = `${videoData.title} - [[MTV]]`;
  }
  if (event.data === 0) {
    console.log("ENDED");
    return endedTimer = setTimeout(function() {
      return playing = false;
    }, 2000);
  }
};

play = function(id, startSeconds = null, endSeconds = null) {
  var opts;
  console.log(`Playing: ${id}`);
  opts = {
    videoId: id
  };
  if ((startSeconds != null) && (startSeconds >= 0)) {
    opts.startSeconds = startSeconds;
  }
  if ((endSeconds != null) && (endSeconds >= 1)) {
    opts.endSeconds = endSeconds;
  }
  player.loadVideoById(opts);
  return playing = true;
};

tick = function() {
  if (!playing && (player != null)) {
    console.log("Ready");
    return socket.emit('ready', {});
  }
};

window.onYouTubePlayerAPIReady = function() {
  doneWaiting();
  console.log("onYouTubePlayerAPIReady");
  player = new YT.Player('player', {
    width: '100%',
    height: '100%',
    videoId: 'AB7ykOfAgIA', // MTV loading screen, this will be replaced almost immediately
    playerVars: {
      'autoplay': 1,
      'controls': 0
    },
    events: {
      onReady: onPlayerReady,
      onStateChange: onPlayerStateChange
    }
  });
  socket = io();
  socket.on('play', function(pkt) {
    console.log(pkt);
    return play(pkt.id, pkt.start, pkt.end);
  });
  socket.on('server', function(server) {
    if ((serverEpoch != null) && (serverEpoch !== server.epoch)) {
      console.log("Server epoch changed! The server must have rebooted. Requesting fresh video...");
      socket.emit('ready', {});
    }
    return serverEpoch = server.epoch;
  });
  return setInterval(tick, 5000);
};

context = cast.framework.CastReceiverContext.getInstance();

playerManager = context.getPlayerManager();

playerManager.setMessageInterceptor(cast.framework.messages.MessageType.LOAD, function() {
  return new Promise(function(resolve, reject) {
    var metadata;
    metadata = new cast.framework.messages.GenericMediaMetadata();
    metadata.title = "Yee Title";
    metadata.subtitle = "Yee Author";
    request.media.metadata = metadata;
    return resolve(request);
  });
});

context.start();

setTimeout(function() {
  return window.onYouTubePlayerAPIReady();
}, 5000);


},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvY2xpZW50L2NsaWVudC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQSxJQUFBLE9BQUEsRUFBQSxXQUFBLEVBQUEsVUFBQSxFQUFBLEtBQUEsRUFBQSxhQUFBLEVBQUEsbUJBQUEsRUFBQSxJQUFBLEVBQUEsTUFBQSxFQUFBLGFBQUEsRUFBQSxPQUFBLEVBQUEsV0FBQSxFQUFBLE1BQUEsRUFBQTs7QUFBQSxNQUFBLEdBQVM7O0FBQ1QsTUFBQSxHQUFTOztBQUNULE9BQUEsR0FBVTs7QUFDVixXQUFBLEdBQWM7O0FBRWQsVUFBQSxHQUFhOztBQUViLEtBQUEsR0FBUSxRQUFBLENBQUMsTUFBRCxDQUFBO0FBQ1IsTUFBQTtFQUFFLENBQUEsR0FBSSxRQUFRLENBQUMsY0FBVCxDQUF3QixZQUF4QjtFQUNKLENBQUMsQ0FBQyxLQUFLLENBQUMsT0FBUixHQUFrQjtTQUNsQixDQUFDLENBQUMsU0FBRixHQUFjO0FBSFI7O0FBS1IsV0FBQSxHQUFjLFFBQUEsQ0FBQSxDQUFBO0FBQ2QsTUFBQTtFQUFFLENBQUEsR0FBSSxRQUFRLENBQUMsY0FBVCxDQUF3QixZQUF4QjtTQUNKLENBQUMsQ0FBQyxLQUFLLENBQUMsT0FBUixHQUFrQjtBQUZOLEVBWmQ7OztBQWlCQSxhQUFBLEdBQWdCLFFBQUEsQ0FBQyxLQUFELENBQUE7U0FDZCxLQUFLLENBQUMsTUFBTSxDQUFDLFNBQWIsQ0FBQTtBQURjLEVBakJoQjs7O0FBcUJBLG1CQUFBLEdBQXNCLFFBQUEsQ0FBQyxLQUFELENBQUE7QUFDdEIsTUFBQTtFQUFFLElBQUcsa0JBQUg7SUFDRSxZQUFBLENBQWEsVUFBYjtJQUNBLFVBQUEsR0FBYSxLQUZmOztFQUlBLFNBQUEsR0FBWSxNQUFNLENBQUMsWUFBUCxDQUFBO0VBQ1osSUFBRyxtQkFBQSxJQUFlLHlCQUFsQjtJQUNFLE9BQU8sQ0FBQyxHQUFSLENBQVksQ0FB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QUFDLElBQXhFLEVBQThFLFFBQUEsQ0FBQSxDQUFBO0FBQzVFLFNBQU8sSUFBSSxPQUFKLENBQVksUUFBQSxDQUFDLE9BQUQsRUFBVSxNQUFWLENBQUE7QUFDckIsUUFBQTtJQUFJLFFBQUEsR0FBVyxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLG9CQUE1QixDQUFBO0lBQ1gsUUFBUSxDQUFDLEtBQVQsR0FBaUI7SUFDakIsUUFBUSxDQUFDLFFBQVQsR0FBb0I7SUFDcEIsT0FBTyxDQUFDLEtBQUssQ0FBQyxRQUFkLEdBQXlCO1dBQ3pCLE9BQUEsQ0FBUSxPQUFSO0VBTGlCLENBQVo7QUFEcUUsQ0FBOUU7O0FBUUEsT0FBTyxDQUFDLEtBQVIsQ0FBQTs7QUFFQSxVQUFBLENBQVcsUUFBQSxDQUFBLENBQUE7U0FDVCxNQUFNLENBQUMsdUJBQVAsQ0FBQTtBQURTLENBQVgsRUFFRSxJQUZGIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwicGxheWVyID0gbnVsbFxyXG5zb2NrZXQgPSBudWxsXHJcbnBsYXlpbmcgPSBmYWxzZVxyXG5zZXJ2ZXJFcG9jaCA9IG51bGxcclxuXHJcbmVuZGVkVGltZXIgPSBudWxsXHJcblxyXG5mYXRhbCA9IChyZWFzb24pIC0+XHJcbiAgZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwbGVhc2V3YWl0JylcclxuICBkLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snXHJcbiAgZC5pbm5lckhUTUwgPSByZWFzb25cclxuXHJcbmRvbmVXYWl0aW5nID0gLT5cclxuICBkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsZWFzZXdhaXQnKVxyXG4gIGQuc3R5bGUuZGlzcGxheSA9ICdub25lJ1xyXG5cclxuIyBhdXRvcGxheSB2aWRlb1xyXG5vblBsYXllclJlYWR5ID0gKGV2ZW50KSAtPlxyXG4gIGV2ZW50LnRhcmdldC5wbGF5VmlkZW8oKVxyXG5cclxuIyB3aGVuIHZpZGVvIGVuZHNcclxub25QbGF5ZXJTdGF0ZUNoYW5nZSA9IChldmVudCkgLT5cclxuICBpZiBlbmRlZFRpbWVyP1xyXG4gICAgY2xlYXJUaW1lb3V0KGVuZGVkVGltZXIpXHJcbiAgICBlbmRlZFRpbWVyID0gbnVsbFxyXG5cclxuICB2aWRlb0RhdGEgPSBwbGF5ZXIuZ2V0VmlkZW9EYXRhKClcclxuICBpZiB2aWRlb0RhdGE/IGFuZCB2aWRlb0RhdGEudGl0bGU/XHJcbiAgICBjb25zb2xlLmxvZyBcIlRpdGxlOiAje3ZpZGVvRGF0YS50aXRsZX1cIlxyXG4gICAgd2luZG93LmRvY3VtZW50LnRpdGxlID0gXCIje3ZpZGVvRGF0YS50aXRsZX0gLSBbW01UVl1dXCJcclxuXHJcbiAgaWYgZXZlbnQuZGF0YSA9PSAwXHJcbiAgICBjb25zb2xlLmxvZyBcIkVOREVEXCJcclxuICAgIGVuZGVkVGltZXIgPSBzZXRUaW1lb3V0KCAtPlxyXG4gICAgICBwbGF5aW5nID0gZmFsc2VcclxuICAgICwgMjAwMClcclxuXHJcbnBsYXkgPSAoaWQsIHN0YXJ0U2Vjb25kcyA9IG51bGwsIGVuZFNlY29uZHMgPSBudWxsKSAtPlxyXG4gIGNvbnNvbGUubG9nIFwiUGxheWluZzogI3tpZH1cIlxyXG4gIG9wdHMgPSB7XHJcbiAgICB2aWRlb0lkOiBpZFxyXG4gIH1cclxuICBpZiBzdGFydFNlY29uZHM/IGFuZCAoc3RhcnRTZWNvbmRzID49IDApXHJcbiAgICBvcHRzLnN0YXJ0U2Vjb25kcyA9IHN0YXJ0U2Vjb25kc1xyXG4gIGlmIGVuZFNlY29uZHM/IGFuZCAoZW5kU2Vjb25kcyA+PSAxKVxyXG4gICAgb3B0cy5lbmRTZWNvbmRzID0gZW5kU2Vjb25kc1xyXG4gIHBsYXllci5sb2FkVmlkZW9CeUlkKG9wdHMpXHJcbiAgcGxheWluZyA9IHRydWVcclxuXHJcbnRpY2sgPSAtPlxyXG4gIGlmIG5vdCBwbGF5aW5nIGFuZCBwbGF5ZXI/XHJcbiAgICBjb25zb2xlLmxvZyBcIlJlYWR5XCJcclxuICAgIHNvY2tldC5lbWl0ICdyZWFkeScsIHt9XHJcblxyXG53aW5kb3cub25Zb3VUdWJlUGxheWVyQVBJUmVhZHkgPSAtPlxyXG4gIGRvbmVXYWl0aW5nKClcclxuICBjb25zb2xlLmxvZyBcIm9uWW91VHViZVBsYXllckFQSVJlYWR5XCJcclxuXHJcbiAgcGxheWVyID0gbmV3IFlULlBsYXllciAncGxheWVyJywge1xyXG4gICAgd2lkdGg6ICcxMDAlJ1xyXG4gICAgaGVpZ2h0OiAnMTAwJSdcclxuICAgIHZpZGVvSWQ6ICdBQjd5a09mQWdJQScgIyBNVFYgbG9hZGluZyBzY3JlZW4sIHRoaXMgd2lsbCBiZSByZXBsYWNlZCBhbG1vc3QgaW1tZWRpYXRlbHlcclxuICAgIHBsYXllclZhcnM6IHsgJ2F1dG9wbGF5JzogMSwgJ2NvbnRyb2xzJzogMCB9XHJcbiAgICBldmVudHM6IHtcclxuICAgICAgb25SZWFkeTogb25QbGF5ZXJSZWFkeVxyXG4gICAgICBvblN0YXRlQ2hhbmdlOiBvblBsYXllclN0YXRlQ2hhbmdlXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzb2NrZXQgPSBpbygpXHJcbiAgc29ja2V0Lm9uICdwbGF5JywgKHBrdCkgLT5cclxuICAgIGNvbnNvbGUubG9nIHBrdFxyXG4gICAgcGxheShwa3QuaWQsIHBrdC5zdGFydCwgcGt0LmVuZClcclxuXHJcbiAgc29ja2V0Lm9uICdzZXJ2ZXInLCAoc2VydmVyKSAtPlxyXG4gICAgaWYgc2VydmVyRXBvY2g/IGFuZCAoc2VydmVyRXBvY2ggIT0gc2VydmVyLmVwb2NoKVxyXG4gICAgICBjb25zb2xlLmxvZyBcIlNlcnZlciBlcG9jaCBjaGFuZ2VkISBUaGUgc2VydmVyIG11c3QgaGF2ZSByZWJvb3RlZC4gUmVxdWVzdGluZyBmcmVzaCB2aWRlby4uLlwiXHJcbiAgICAgIHNvY2tldC5lbWl0ICdyZWFkeScsIHt9XHJcbiAgICBzZXJ2ZXJFcG9jaCA9IHNlcnZlci5lcG9jaFxyXG5cclxuICBzZXRJbnRlcnZhbCh0aWNrLCA1MDAwKVxyXG5cclxuY29udGV4dCA9IGNhc3QuZnJhbWV3b3JrLkNhc3RSZWNlaXZlckNvbnRleHQuZ2V0SW5zdGFuY2UoKVxyXG5wbGF5ZXJNYW5hZ2VyID0gY29udGV4dC5nZXRQbGF5ZXJNYW5hZ2VyKClcclxuXHJcbnBsYXllck1hbmFnZXIuc2V0TWVzc2FnZUludGVyY2VwdG9yIGNhc3QuZnJhbWV3b3JrLm1lc3NhZ2VzLk1lc3NhZ2VUeXBlLkxPQUQsIC0+XHJcbiAgcmV0dXJuIG5ldyBQcm9taXNlIChyZXNvbHZlLCByZWplY3QpIC0+XHJcbiAgICBtZXRhZGF0YSA9IG5ldyBjYXN0LmZyYW1ld29yay5tZXNzYWdlcy5HZW5lcmljTWVkaWFNZXRhZGF0YSgpXHJcbiAgICBtZXRhZGF0YS50aXRsZSA9IFwiWWVlIFRpdGxlXCJcclxuICAgIG1ldGFkYXRhLnN1YnRpdGxlID0gXCJZZWUgQXV0aG9yXCJcclxuICAgIHJlcXVlc3QubWVkaWEubWV0YWRhdGEgPSBtZXRhZGF0YVxyXG4gICAgcmVzb2x2ZShyZXF1ZXN0KVxyXG5cclxuY29udGV4dC5zdGFydCgpXHJcblxyXG5zZXRUaW1lb3V0KC0+XHJcbiAgd2luZG93Lm9uWW91VHViZVBsYXllckFQSVJlYWR5KClcclxuLCA1MDAwKVxyXG4iXX0=
